(function(){"use strict";var e={5727:function(e,t,n){var i=n(9242),o=n(3396);function s(e,t,n,i,s,a){const r=(0,o.up)("Secrets");return(0,o.wg)(),(0,o.j4)(r)}var a=n(7139);const r=e=>((0,o.dD)("data-v-0fa5fd22"),e=e(),(0,o.Cn)(),e),l=r((()=>(0,o._)("canvas",{id:"myCanvas"},null,-1))),c={key:0,class:"absolute w-1/3 h-1/4 border-4 border-white text-white text-3xl font-mono top-1/2 left-1/2 font-semibold py-3 -translate-x-1/2 -translate-y-1/2 px-1 z-50 bg-black/50"},h={class:"relative w-full break-normal select-none"},d={id:"description",class:"h-full flex"},u=["id"],m={class:(0,a.C_)("transition-all delay-500 ease-in-out px-10 whitespace-pre h-full absolute w-full block")},f={class:"float-right text-white font-bold underline"},w=r((()=>(0,o._)("br",null,null,-1))),p={class:"float-right text-white font-bold underline"},v=r((()=>(0,o._)("br",null,null,-1))),g={class:"float-right text-white font-bold underline"},x=["disabled"],T={class:"w-full justify-between content-between"},y=["disabled"],b=["disabled"];function k(e,t,n,s,r,k){return(0,o.wg)(),(0,o.iD)(o.HY,null,[l,r.showWarningBanner?((0,o.wg)(),(0,o.iD)("div",c,[(0,o._)("div",h,(0,a.zw)(r.warningText),1),(0,o._)("button",{class:"absolute border-4 border-white w-1/4 rounded-sm bottom-2 font-mono text-2xl -translate-x-1/2",onClick:t[0]||(t[0]=e=>r.showWarningBanner=!1)}," OK ")])):(0,o.kq)("",!0),(0,o._)("div",d,[(0,o._)("div",{id:0!=r.welcomeText.length||r.introPhase?"intro":"",class:(0,a.C_)("text-white transition-all break-all px-10 capitalize text-left delay-2000 duration-1000 font-bold font-mono text-5xl "+(r.introPhase,"translate-y-1/2"))},(0,a.zw)(r.welcomeText),11,u),(0,o._)("div",m,[(0,o._)("div",{class:(0,a.C_)("text-white break-all relative delay-200 duration-1000 capitalize text-left font-mono text-3xl leading-relaxed font-semibold "+(r.introPhase||0!=r.welcomeText.length?" mt-20 opacity-0":" top-0 mt-10 opacity-100"))},[(0,o.Uk)(" PRISM ID "),(0,o._)("div",f,(0,a.zw)(k.pad(r.lastPickedID)),1),w,(0,o.Uk)(" VIEW COUNT "),(0,o._)("div",p,(0,a.zw)(r.viewedTime),1),v,(0,o.Uk)(" CHANGE COUNT "),(0,o._)("div",g,(0,a.zw)(r.changedTime),1)],2),(0,o.wy)((0,o._)("textarea",{disabled:r.introPhase||r.showWarningBanner,class:(0,a.C_)("h-1/2 bg-black w-full py-3 px-4 flex rounded-sm shadow-xl delay-200 duration-1000 text-left text-3xl text-white font-mono resize-none border-solid border-4 border-white disabled:border-gray-500"+(r.introPhase||0!=r.welcomeText.length?" mt-20 opacity-0":" mt-10 opacity-100 mb-10 pointer-events-auto")),"onUpdate:modelValue":t[1]||(t[1]=e=>r.secretText=e),placeholder:"This is an empty prism, Add Your Own Message Here",maxlength:"500",autofocus:""},null,10,x),[[i.nr,r.secretText]]),(0,o._)("div",{class:(0,a.C_)("absolute -mt-16 right-12 text-white/50 font-mono delay-500 duration-1000"+(r.introPhase||0!=r.welcomeText.length?" -mt-10 opacity-0":" opacity-100 "))},(0,a.zw)(k.pad(r.secretText.length,3)+"/500"),3),(0,o._)("div",T,[(0,o._)("button",{disabled:r.introPhase||r.showWarningBanner,class:(0,a.C_)("float-left largeButton"+(r.introPhase||0!=r.welcomeText.length?" opacity-0 mt-20":" opacity-100 pointer-events-auto")),onClick:t[2]||(t[2]=e=>k.updateText())}," CHANGE ",10,y),(0,o._)("button",{disabled:r.introPhase||r.showWarningBanner,class:(0,a.C_)("float-right largeButton"+(r.introPhase||0!=r.welcomeText.length?" opacity-0 mt-20":" opacity-100 pointer-events-auto")),onClick:t[3]||(t[3]=(...e)=>k.leaveSecret&&k.leaveSecret(...e))}," LEAVE ",10,b)])])])],64)}n(7658),n(1439),n(7585),n(5315);var P=n(1114),I=n(1987),z=n(8281),C=n(7346),M=n(6859),D=n(8039);const W=new D.ZP("https://secrets.pockethost.io"),A=new P.iMs,_=new P.FM8,S=new P.xsS,O=new P.cPb(45,2*window.innerWidth/window.innerHeight,1e-7,1e3);var E=new P.CP7;E.setSize(2*window.innerWidth,window.innerHeight),document.body.appendChild(E.domElement);var j=new P.Pa4(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1).normalize().multiplyScalar(2);O.position.copy(j);const B="\nattribute vec3 barycentric;\nattribute float even;\nvarying vec3 vBarycentric;\nvarying vec3 vPosition;\nvarying vec2 vUv;\nvoid main () {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n  vBarycentric = barycentric;\n  vPosition = position.xyz;\n  vUv = uv;\n}\n",F="\nvarying vec3 vBarycentric;\nvarying float vEven;\nvarying vec2 vUv;\nvarying vec3 vPosition;\n\nuniform float time;\nuniform float thickness;\nuniform float secondThickness;\n\nuniform float dashRepeats;\nuniform float dashLength;\nuniform bool dashOverlap;\nuniform bool dashEnabled;\nuniform bool dashAnimate;\n\nuniform bool seeThrough;\nuniform bool insideAltColor;\nuniform bool dualStroke;\n\nuniform bool squeeze;\nuniform float squeezeMin;\nuniform float squeezeMax;\n\nuniform vec3 stroke;\nuniform vec3 fill;\n\nuniform float customAlpha;\n\n#define PI 3.1415926538\n\n// This is like\nfloat aastep (float threshold, float dist) {\n  float afwidth = fwidth(dist) * 0.5;\n  return smoothstep(threshold - afwidth, threshold + afwidth, dist);\n}\n\n// This function is not currently used, but it can be useful\n// to achieve a fixed width wireframe regardless of z-depth\nfloat computeScreenSpaceWireframe (vec3 barycentric, float lineWidth) {\n  vec3 dist = fwidth(barycentric);\n  vec3 smoothed = smoothstep(dist * ((lineWidth * 0.5) - 0.5), dist * ((lineWidth * 0.5) + 0.5), barycentric);\n  return 1.0 - min(min(smoothed.x, smoothed.y), smoothed.z);\n}\n\n// This function returns the fragment color for our styled wireframe effect\n// based on the barycentric coordinates for this fragment\nvec4 getStyledWireframe (vec3 barycentric) {\n  // this will be our signed distance for the wireframe edge\n  float d = min(min(barycentric.x, barycentric.y), barycentric.z);\n\n  // for dashed rendering, we can use this to get the 0 .. 1 value of the line length\n  float positionAlong = max(barycentric.x, barycentric.y);\n  if (barycentric.y < barycentric.x && barycentric.y < barycentric.z) {\n    positionAlong = 1.0 - positionAlong;\n  }\n\n  // the thickness of the stroke\n  float computedThickness = thickness;\n\n  // if we want to shrink the thickness toward the center of the line segment\n  if (squeeze) {\n    computedThickness *= mix(squeezeMin, squeezeMax, (1.0 - sin(positionAlong * PI)));\n  }\n\n  // if we should create a dash pattern\n  if (dashEnabled) {\n    // here we offset the stroke position depending on whether it\n    // should overlap or not\n    float offset = 1.0 / dashRepeats * dashLength / 2.0;\n    if (!dashOverlap) {\n      offset += 1.0 / dashRepeats / 2.0;\n    }\n\n    // if we should animate the dash or not\n    if (dashAnimate) {\n      offset += time * 0.22;\n    }\n\n    // create the repeating dash pattern\n    float pattern = fract((positionAlong + offset) * dashRepeats);\n    computedThickness *= 1.0 - aastep(dashLength, pattern);\n  }\n\n  // compute the anti-aliased stroke edge  \n  float edge = 1.0 - aastep(computedThickness, d);\n\n  // now compute the final color of the mesh\n  vec4 outColor = vec4(0.0);\n  if (seeThrough) {\n    outColor = vec4(stroke, min(edge, customAlpha));\n    if (insideAltColor && !gl_FrontFacing) {\n      outColor.rgb = fill;\n    }\n  } else {\n    vec3 mainStroke = mix(fill, stroke, edge);\n    outColor.a = 1.0;\n    if (dualStroke) {\n      float inner = 1.0 - aastep(secondThickness, d);\n      vec3 wireColor = mix(fill, stroke, abs(inner - edge));\n      outColor.rgb = wireColor;\n    } else {\n      outColor.rgb = mainStroke;\n    }\n  }\n\n  return outColor;\n}\n\nvoid main () {\n  gl_FragColor = getStyledWireframe(vBarycentric);\n}\n\n";function L(e,t=!1){const n=e.getIndex()||e.getAttribute("position"),i=n.count/3,o=[];for(let r=0;r<i;r++){const e=r%2===0,n=t?1:0;e?o.push(0,0,1,0,1,0,1,0,n):o.push(0,1,0,0,0,1,1,0,n)}const s=new Float32Array(o),a=new P.TlE(s,3);e.setAttribute("barycentric",a)}const U=new P.jyz({extensions:{derivatives:!0},transparent:!0,uniforms:{time:{value:0},stroke:{value:new P.Ilk(15528948)},fill:{value:new P.Ilk(16530001)},dualStroke:{value:!1},seeThrough:{value:!0},insideAltColor:{value:!1},thickness:{value:.12},secondThickness:{value:.03},dashEnabled:{value:!1},dashRepeats:{value:2},dashOverlap:{value:!0},dashLength:{value:.4},dashAnimate:{value:!1},squeeze:{value:!1},squeezeMin:{value:.01},squeezeMax:{value:1},customAlpha:{value:1}},vertexShader:B,fragmentShader:F}),H=new P.vBJ({color:0,transparent:!0,opacity:0});var q=U.clone(),N=U.clone();N.uniforms.seeThrough.value=!1,N.uniforms.thickness.value=.2,N.uniforms.secondThickness.value=.03,N.uniforms.fill.value=new P.Ilk(16777215),N.uniforms.stroke.value=new P.Ilk(0),N.uniforms.dualStroke.value=!0;const R=new z.j;var Y=[],V=[],K=[],Z=[],G=[];R.load("SkullTest.stl",(function(e){const t=new P.Kj0(e),n=new M.a(t).build();t.rotation.x=-Math.PI/2,t.scale.set(.5,.5,.5),t.geometry.center();const i=new P.Pa4,o=new P.Pa4;for(let a=0;a<5e3;a++){n.sample(i,o);const e=o.clone();K.push(e);var s=new C.H(.048);L(s);const t=new P.Kj0(s,q);t.position.x=i.x,t.position.y=i.z,t.position.z=-i.y,t.rotation.x=2*Math.random()*Math.PI,t.rotation.y=2*Math.random()*Math.PI,t.rotation.z=2*Math.random()*Math.PI,t.meshID=a,Y.push({x:t.position.x,y:t.position.y,z:t.position.z}),V.push(1e3*Math.random()),Z.push(Math.random()),S.add(t),G.push(t)}}),(e=>{console.log(e.loaded/e.total*100+"% loaded")}),(e=>{showWarning("Loading mesh failed"),console.log(e)})),E.setClearColor(0,1),S.background=new P.Ilk(0),document.body.appendChild(E.domElement);var J=new Date,X={name:"Secrets",data(){return{lastPickedID:-1,controls:null,clickTransition:!1,clickTransitionProgress:0,exitTransition:!1,exitTransitionProgress:0,mouseDown:!1,welcomeText:"",introPhase:!0,texts:["Welcome to the prisms","You can drag, zoom and rotate using your mouse","Click on a prism to view its content","Or press space bar to view a random one","You can also edit the content within a prism","Have fun"],welcomeTextChoice:0,deleteIntro:!1,changedTime:"N/A",viewedTime:"N/A",secretText:"",secretTextOriginal:"",secretID:"",showWarningBanner:!1,warningText:"This is a warning"}},watch:{},methods:{pad(e,t=4){var n="0".repeat(t)+e;return n.substr(n.length-t)},showWarning(e){this.warningText=e,this.showWarningBanner=!0},onWindowResize(){O.aspect=2*window.innerWidth/window.innerHeight,O.updateProjectionMatrix(),E.setSize(2*window.innerWidth,window.innerHeight)},onPointerMove(e){this.mouseDown=!1,_.x=(e.clientX+.75*window.innerWidth)/window.innerWidth/2*2-1,_.y=-e.clientY/window.innerHeight*2+1},async updateView(e){try{await W.collection("posts").update(e,{"viewedNumber+":1})}catch(t){this.showWarning("Failed to update view, code "+t.data.code),console.log("UPDATE VIEW FAILED: "+t)}},async updateText(){if(this.secretText!=this.secretTextOriginal)if(0!=this.secretText.length)if(this.secretText.length>500)this.showWarning("You cannot exceed 500 characters");else try{let e=this;const t=await W.collection("posts").update(e.secretID,{text:e.secretText,"changedNumber+":1});e.changedTime=t.changedNumber,e.secretTextOriginal=e.secretText,e.showWarning("Text updated successfully")}catch(e){this.showWarning("Failed to update text, code "+e.data.code),console.log(e)}else this.showWarning("You cannot leave the text empty");else this.showWarning("You have not changed the text")},async mouseUp(){if(this.mouseDown&&-1!=this.lastPickedID&&!this.clickTransition&&!this.exitTransition){this.mouseDown=!1,this.clickTransition=!0,this.introPhase=!1,this.deleteIntro=!0,await this.deleteText();try{const e=await W.collection("posts").getFirstListItem("prismID="+this.lastPickedID);this.viewedTime=e.viewedNumber+1,this.changedTime=e.changedNumber,this.secretText=e.text,this.secretTextOriginal=e.text,this.secretID=e.id,this.updateView(e.id)}catch(e){this.showWarning("Failed to get record, code "+e.data.code),console.log(e)}}},leaveSecret(){if(this.clickTransition&&this.clickTransitionProgress>=1){this.clickTransition=!1,this.clickTransitionProgress=0,this.exitTransition=!0,this.exitTransitionProgress=1,j=new P.Pa4(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1).normalize().multiplyScalar(2),this.introPhase=!0,setTimeout((()=>{this.deleteIntro=!1,this.addText()}),2e3);for(var e=0;e<G.length;e++)e!=this.lastPickedID&&(G[e].material=q,G[e].scale.x=1,G[e].scale.y=1,G[e].scale.z=1)}},async deleteText(){let e=this;0==!e.welcomeText.length?setTimeout((async()=>{e.welcomeText=e.welcomeText.slice(0,-1),await e.deleteText()}),30):!e.deleteIntro&&e.introPhase&&(e.welcomeTextChoice=(e.welcomeTextChoice+1)%e.texts.length,setTimeout((()=>{e.addText()}),1e3))},async addText(){let e=this;e.texts[this.welcomeTextChoice].length>e.welcomeText.length&&!e.deleteIntro&&e.introPhase?setTimeout((async()=>{e.welcomeText+=e.texts[this.welcomeTextChoice][e.welcomeText.length]?e.texts[this.welcomeTextChoice][e.welcomeText.length]:"",await e.addText()}),80):(e.deleteIntro||!e.introPhase||e.texts[this.welcomeTextChoice].length>=e.welcomeText.length)&&setTimeout((()=>{e.deleteText()}),2e3)},updatePositionAndRotation(e,t,n=!0){Z[e]+=t!=G[e].meshID?.015:0,G[e].rotation.x+=.02,G[e].rotation.y+=.02,G[e].position.x=Y[e].x+.2*Math.sin(Z[e]+V[e])*K[e].x,G[e].position.y=Y[e].y+.2*Math.sin(Z[e]+V[e])*K[e].y,G[e].position.z=Y[e].z+.2*Math.sin(Z[e]+V[e])*K[e].z,G[e].updateMatrixWorld()},previewMoveCursor(){if(!this.clickTransition&&!this.exitTransition){A.setFromCamera(_,O);const e=A.intersectObjects(S.children),t=e.length>0?e[0].object.meshID:-1;t!=this.lastPickedID&&(-1!=this.lastPickedID&&(G[this.lastPickedID].material=q),-1!=t&&(G[t].material=N),this.lastPickedID=t)}},async keypress(e){if(" "==e.key&&this.introPhase&&!this.clickTransition&&!this.exitTransition){-1!=this.lastPickedID&&(G[this.lastPickedID].material=q);const e=Math.floor(5e3*Math.random());G[e].material=N,this.lastPickedID=e;let t=this;t.mouseDown=!0,t.mouseUp()}},focus(){if(this.clickTransition)if(this.clickTransitionProgress<1){this.clickTransitionProgress+=.01,this.controls.target.lerp(G[this.lastPickedID].position,Math.pow(this.clickTransitionProgress,2));var e=G[this.lastPickedID].position.clone();e.normalize();const t=new P.Pa4(G[this.lastPickedID].position.x+.15*e.x,G[this.lastPickedID].position.y+.15*e.y,G[this.lastPickedID].position.z+.15*e.z),n=new P.Pa4(G[this.lastPickedID].position.x-.15*e.x,G[this.lastPickedID].position.y-.15*e.y,G[this.lastPickedID].position.z-.15*e.z),i=O.position.distanceTo(t)<O.position.distanceTo(n)?t:n;O.position.lerp(i,Math.pow(this.clickTransitionProgress,5)),q.uniforms.customAlpha.value=Math.pow(1-this.clickTransitionProgress,5),this.controls.enabled=!1}else{for(var t=0;t<G.length;t++)t!=this.lastPickedID&&(G[t].material=H,G[t].scale.x=0,G[t].scale.y=0,G[t].scale.z=0);this.controls.enabled=!0}},exitFocus(){this.exitTransition&&(this.exitTransitionProgress>0?(this.exitTransitionProgress-=.015,this.controls.target.lerp(new P.Pa4(0,0,0),Math.pow(1-this.exitTransitionProgress,5)),O.position.lerp(j,Math.pow(1-this.exitTransitionProgress,5)),q.uniforms.customAlpha.value=Math.pow(1-this.exitTransitionProgress,2),this.controls.enabled=!1):(this.exitTransition=!1,this.previewMoveCursor(),this.controls.enabled=!0))},animate(){let e=this;setTimeout((function(){requestAnimationFrame(e.animate)}),1e3/60),this.previewMoveCursor(),this.focus(),this.exitFocus();for(var t=0;t<G.length;t++)e.updatePositionAndRotation(t,this.lastPickedID);J=new Date;const n=J.getTime();N.uniforms.time.value=n/1e3%100,E.render(S,O),e.controls.update()}},mounted(){var e=document.getElementById("myCanvas");E=new P.CP7({canvas:e,antialias:!0}),E.setSize(2*window.innerWidth,window.innerHeight),this.controls=new I.$(O,E.domElement),this.controls.enableDamping=!0,this.controls.rotateSpeed=2.5,this.animate(),window.addEventListener("resize",this.onWindowResize),window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("mouseup",this.mouseUp),window.addEventListener("mousedown",(()=>{this.mouseDown=!0})),window.addEventListener("keypress",this.keypress),this.addText()}},$=n(89);const Q=(0,$.Z)(X,[["render",k],["__scopeId","data-v-0fa5fd22"]]);var ee=Q,te={name:"App",components:{Secrets:ee}};const ne=(0,$.Z)(te,[["render",s]]);var ie=ne;(0,i.ri)(ie).mount("#app")}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,n),s.exports}n.m=e,function(){var e=[];n.O=function(t,i,o,s){if(!i){var a=1/0;for(h=0;h<e.length;h++){i=e[h][0],o=e[h][1],s=e[h][2];for(var r=!0,l=0;l<i.length;l++)(!1&s||a>=s)&&Object.keys(n.O).every((function(e){return n.O[e](i[l])}))?i.splice(l--,1):(r=!1,s<a&&(a=s));if(r){e.splice(h--,1);var c=o();void 0!==c&&(t=c)}}return t}s=s||0;for(var h=e.length;h>0&&e[h-1][2]>s;h--)e[h]=e[h-1];e[h]=[i,o,s]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,i){var o,s,a=i[0],r=i[1],l=i[2],c=0;if(a.some((function(t){return 0!==e[t]}))){for(o in r)n.o(r,o)&&(n.m[o]=r[o]);if(l)var h=l(n)}for(t&&t(i);c<a.length;c++)s=a[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(h)},i=self["webpackChunksecrets"]=self["webpackChunksecrets"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=n.O(void 0,[998],(function(){return n(5727)}));i=n.O(i)})();
//# sourceMappingURL=app.c97eeb92.js.map